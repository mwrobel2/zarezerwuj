<main>
  <span *ngIf="userIsAuthenticated">
    <div id="menu">
      <mat-button-toggle-group name="fontStyle" aria-label="Font Style">
        <mat-button-toggle routerLink="/glownemenu">STRONA GŁÓWNA</mat-button-toggle>
        <mat-button-toggle routerLink="/lazy/offer">Oferty</mat-button-toggle>
        <mat-button-toggle class="imhere"><b>Dodaj ofertę</b></mat-button-toggle>
        <mat-button-toggle (click)="logout()"></mat-button-toggle>
      </mat-button-toggle-group>
    </div>

    <mat-card>
      <!-- template driven form -->
      <form (submit)="onSaveOffer(offerCreateForm)" #offerCreateForm="ngForm">
        <button mat-raised-button color="primary" type="submit">
          Zapisz ofertę
        </button>
        &nbsp;
        <button mat-raised-button color="primary" type="button" (click)="powrot()">
          Anuluj
        </button>
        <h4>Szczegóły oferty</h4>

        <mat-form-field>
          <input matInput type="text" name="shortName" [ngModel]="offer?.contractor.shortName"
            placeholder="Kontrahent - nazwa krótka" />
        </mat-form-field>

        <mat-form-field>
          <input matInput type="text" name="fullName" [ngModel]="offer?.contractor.fullName"
            placeholder="Kontrahent - nazwa długa" />
        </mat-form-field>

        <mat-form-field>
          <input matInput type="text" name="nip" [ngModel]="offer?.contractor.nip" placeholder="NIP Kontrahenta" />
        </mat-form-field>

        <mat-form-field>
          <input matInput type="date" name="data" [ngModel]="offer?.data | date: 'yyyy-MM-dd'" placeholder="data"
            disabled />
        </mat-form-field>

        <mat-form-field>
          <input matInput type="text" name="creator" [ngModel]="offer?.creator" placeholder="sporządził" disabled />
        </mat-form-field>

        <mat-form-field>
          <input matInput type="text" name="termsOfPayment" [ngModel]="offer?.termsOfPayment"
            placeholder="warunki płatności" />
        </mat-form-field>

        <mat-form-field>
          <input matInput type="text" name="deliveryType" [ngModel]="offer?.deliveryType"
            placeholder="warunki dostawy" />
        </mat-form-field>

        <mat-form-field>
          <input matInput type="text" name="labelling" [ngModel]="offer?.labelling" placeholder="znakowanie" />
        </mat-form-field>

        <mat-form-field>
          <input matInput type="text" name="packing" [ngModel]="offer?.packing" placeholder="pakowanie" />
        </mat-form-field>

        <mat-form-field>
          <input matInput type="text" name="certificate" [ngModel]="offer?.certificate" placeholder="certyfikat" />
        </mat-form-field>

        <!-- <mat-form-field>
          <input matInput type="text" name="realization" [ngModel]="offer?.realization" placeholder="wykonanie" />
        </mat-form-field> -->

        <mat-form-field>
          <input matInput type="text" name="engeneeringTolerance" [ngModel]="offer?.engeneeringTolerance"
            placeholder="tolerancja wykonania" />
        </mat-form-field>

        <mat-form-field>
          <input matInput type="text" name="origin" [ngModel]="offer?.origin" placeholder="pochodzenie towaru" />
        </mat-form-field>

        <mat-form-field>
          <mat-label>Waluta</mat-label>
          <mat-select [ngModel]="offer?.currency" name="currency">
            <mat-option *ngFor="let waluta of dictionaries[1]?.values" value="{{ waluta }}">{{ waluta }}
            </mat-option>
          </mat-select>
        </mat-form-field>

        <mat-form-field>
          <input matInput type="text" name="project" [ngModel]="offer?.project" placeholder="projekt" />
        </mat-form-field>

        <mat-form-field>
          <input matInput type="text" name="company" [ngModel]="offer?.company" placeholder="firma" />
        </mat-form-field>

        <mat-form-field>
          <textarea matInput rows="4" name="comments" [ngModel]="offer?.comments" placeholder="uwagi"></textarea>
        </mat-form-field>

        <div *ngIf="this.offer.items.length > 0">
          <div *ngIf="this.offer.items[0].name" class="tabelaDiv">
            <table mat-table [dataSource]="goodsDataSource" class="mat-elevation-z8">

              <ng-container matColumnDef="name">
                <th mat-header-cell *matHeaderCellDef class="klasaKolumny">Nazwa</th>
                <td mat-cell *matCellDef="let element" class="klasaKolumny">{{ element.name }}</td>
              </ng-container>

              <ng-container matColumnDef="priceNetSell">
                <th mat-header-cell *matHeaderCellDef class="klasaKolumny">Netto</th>
                <td mat-cell *matCellDef="let element" class="klasaKolumny">{{ element.priceNetSell }}</td>
              </ng-container>

              <ng-container matColumnDef="vat">
                <th mat-header-cell *matHeaderCellDef class="klasaKolumny">VAT</th>
                <td mat-cell *matCellDef="let element" class="klasaKolumny">{{ element.vat }}</td>
              </ng-container>

              <ng-container matColumnDef="priceGrossSell">
                <th mat-header-cell *matHeaderCellDef class="klasaKolumny">Brutto</th>
                <td mat-cell *matCellDef="let element" class="klasaKolumny">{{ element.priceGrossSell }}</td>
              </ng-container>

              <ng-container matColumnDef="action">
                <th mat-header-cell *matHeaderCellDef class="klasaKolumny">Akcje</th>
                <td mat-cell *matCellDef="let element">
                  <mat-action-row>
                    <button mat-button color="primary" (click)="editCommodity(element)" type="button">
                      Edytuj
                    </button>
                    <button mat-button color="warn" (click)="deleteCommodity(element)" type="button">
                      Usuń
                    </button>
                  </mat-action-row>
                </td>
              </ng-container>

              <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
              <tr mat-row *matRowDef="let row; columns: displayedColumns"></tr>
            </table>
          </div>
        </div>




        <div *ngIf="posFromWarehouse" class="itemClass">
          <mat-accordion>
            <mat-expansion-panel [expanded]=true>
              <mat-expansion-panel-header>
                <b>Dodaj towar z magazynu</b>
              </mat-expansion-panel-header>

              <div class="mat-elevation-z8">
                <table mat-table [dataSource]="warehouseItems">

                  <ng-container matColumnDef="shortName">
                    <th mat-header-cell *matHeaderCellDef class="klasaKolumny">Nazwa</th>
                    <td mat-cell *matCellDef="let element" class="klasaKolumny">{{ element.shortName }}</td>
                  </ng-container>

                  <ng-container matColumnDef="pricePurchase">
                    <th mat-header-cell *matHeaderCellDef class="klasaKolumny">Netto</th>
                    <td mat-cell *matCellDef="let element" class="klasaKolumny">{{ element.pricePurchase }}</td>
                  </ng-container>

                  <ng-container matColumnDef="action">
                    <th mat-header-cell *matHeaderCellDef class="klasaKolumny">Akcje</th>
                    <td mat-cell *matCellDef="let element">
                      <mat-action-row>
                        <button mat-button color="primary" type="button">
                          Dodaj
                        </button>
                      </mat-action-row>
                    </td>
                  </ng-container>

                  <tr mat-header-row *matHeaderRowDef="dispColWarehouse"></tr>
                  <tr mat-row *matRowDef="let row; columns: dispColWarehouse"></tr>
                </table>
                <mat-paginator [pageSizeOptions]="[3, 6, 9]" showFirstLastButtons></mat-paginator>
              </div>

            </mat-expansion-panel>
          </mat-accordion>
        </div>











        <div *ngIf="posFromHand" class="itemClass">
          <mat-accordion>
            <mat-expansion-panel [expanded]=true>
              <mat-expansion-panel-header>
                <b>Dodaj ręcznie towar do oferty</b>
              </mat-expansion-panel-header>
              <mat-form-field>
                <input matInput type="text" name="itemName" [(ngModel)]="offer?.item.name" placeholder="Nazwa towaru" />
              </mat-form-field>
              <div class="itemsPriceVat">
                <mat-form-field>
                  <input matInput type="number" name="itemPriceNetSell" [(ngModel)]="offer?.item.priceNetSell"
                    placeholder="Cena netto" (keyup)="obliczBrutto()" />
                </mat-form-field>
                &nbsp;
                <mat-form-field>
                  <input matInput type="number" name="itemvat" [(ngModel)]="offer?.item.vat" placeholder="VAT"
                    (keyup)="obliczNettoBrutto()" />
                </mat-form-field>
                &nbsp;
                <mat-form-field>
                  <input matInput type="number" name="itemPriceGrossSell" [(ngModel)]="offer?.item.priceGrossSell"
                    placeholder="Cena brutto" (keyup)="obliczNetto()" />
                </mat-form-field>
              </div>
              <button mat-raised-button color="primary" type="button" (click)="addItem()">
                Dodaj towar do oferty
              </button>
            </mat-expansion-panel>
          </mat-accordion>
        </div>

        <div class="ukryjButtons" *ngIf="this.posFromHand">
          <button mat-raised-button type="button" (click)="fromHand()">
            Ukryj formatkę ręcznego dodawania towaru
          </button>
        </div>

        <div class="ukryjButtons" *ngIf="this.posFromWarehouse">
          <button mat-raised-button type="button" (click)="fromWarehouse()">
            Ukryj formatkę dodawania towaru z magazynu
          </button>
        </div>

        <button mat-raised-button disabled>
          Dodaj towar z asortymentu
        </button>
        &nbsp;
        <button mat-raised-button (click)="fromWarehouse()" *ngIf="!this.posFromWarehouse">
          Dodaj towar z magazynu
        </button>
        &nbsp;
        <button mat-raised-button type="button" (click)="fromHand()" *ngIf="!this.posFromHand">
          Dodaj towar ręcznie
        </button>


        <br /><br />

        <button mat-raised-button color="primary" type="submit">
          Zapisz ofertę
        </button>
        &nbsp;
        <button mat-raised-button color="primary" type="button" (click)="powrot()">
          Anuluj
        </button>
      </form>
    </mat-card>
  </span>

  <div id="carddiv" *ngIf="!userIsAuthenticated">
    <mat-card class="example-card">
      <mat-card-header>
        <div mat-card-avatar class="example-header-image"></div>
        <mat-card-title>Nie zalogowany</mat-card-title>
        <mat-card-subtitle>Zaloguj się do systemu aby zapisać dane.</mat-card-subtitle>
      </mat-card-header>
      <mat-card-actions>
        <button mat-raised-button color="primary" routerLink="/login">
          Logowanie do systemu
        </button>
      </mat-card-actions>
    </mat-card>
  </div>
</main>
