<!-- <app-menu></app-menu> -->
<main>
  <!-- <span *ngIf="userIsAuthenticated"> -->
  <span>
    <div id="menu">
      <mat-button-toggle-group name="fontStyle" aria-label="Font Style">
        <mat-button-toggle routerLink="/glownemenu"
          >STRONA GŁÓWNA</mat-button-toggle
        >
        <mat-button-toggle class="imhere"><b>Umowy</b></mat-button-toggle>
        <mat-button-toggle
          routerLink="/contractorcreate"
          *ngIf="dispFields.buttonDodajKontr"
          >Dodaj umowę
        </mat-button-toggle>
        <mat-button-toggle (click)="logout()"
          >{{ this.loggedInUser.name }} {{ this.loggedInUser.surname }}
        </mat-button-toggle>
      </mat-button-toggle-group>
    </div>
    <div class="searchClass">
      <form
        (submit)="onSearchKontrahent(kontrahentSearchForm)"
        #kontrahentSearchForm="ngForm"
        class="searchForm"
      >
        &nbsp;
        <mat-form-field class="formfiel">
          <mat-placeholder class="placclass">krótka nazwa</mat-placeholder>
          <input
            matInput
            type="text"
            name="nazwaKrotka"
            [(ngModel)]="contractor.shortName"
          />
        </mat-form-field>
        &nbsp;
        <mat-form-field class="formfiel">
          <mat-placeholder class="placclass">pełna nazwa</mat-placeholder>
          <input
            matInput
            type="text"
            name="nazwaPelna"
            [(ngModel)]="contractor.fullName"
          />
        </mat-form-field>
        &nbsp;
        <mat-form-field class="formfiel">
          <mat-placeholder class="placclass">NIP</mat-placeholder>
          <input matInput type="text" name="nip" [(ngModel)]="contractor.nip" />
        </mat-form-field>
        &nbsp;
        <mat-form-field class="formfiel" *ngIf="dispFields.comments">
          <mat-placeholder class="placclass">uwagi</mat-placeholder>
          <input
            matInput
            type="text"
            name="comments"
            [(ngModel)]="contractor.comments"
          />
        </mat-form-field>
        <button mat-raised-button type="submit">
          Szukaj
        </button>
        <button
          mat-raised-button
          color="primary"
          type="button"
          (click)="clearForm(kontrahentSearchForm)"
        >
          Wyczyść
        </button>
      </form>
    </div>

    <mat-spinner *ngIf="isLoading" class="spin"></mat-spinner>
    <mat-accordion multi="true" *ngIf="contractors.length > 0 && !isLoading">
      <mat-expansion-panel *ngFor="let contractor of contractors">
        <mat-expansion-panel-header>
          <div id="dispHeader">
            <span id="spanNazwa">
              <b>{{ contractor.shortName | uppercase }}</b>
            </span>
            <span id="spanSpacer"></span>
            <span id="spanSaldo" *ngIf="dispFields.balance">
              Saldo: {{ contractor.balance }}
              {{ contractor.creditLimitCurrency }}
            </span>
          </div>
        </mat-expansion-panel-header>
        <div id="dispContent">
          <div id="infoBasic">
            <p>
              <b>{{ contractor.fullName }}</b
              ><br />
              <span *ngIf="contractor.nip"
                >NIP: <b>{{ contractor.nip }}</b></span
              >
              &nbsp;
              <span
                >TYP:<b>{{ contractor.contrType }}</b></span
              >
            </p>
            <span *ngIf="dispFields.adres">
              <mat-accordion>
                <mat-expansion-panel
                  *ngIf="
                    contractor.city ||
                    contractor.street ||
                    contractor.postcode ||
                    contractor.country ||
                    contractor.ceo
                  "
                >
                  <mat-expansion-panel-header>
                    Adres siedziby, KRS, REGON
                  </mat-expansion-panel-header>
                  <p *ngIf="contractor.street">
                    ulica i nr domu: <b>{{ contractor.street }}</b>
                  </p>
                  <p *ngIf="contractor.city">
                    miasto: <b>{{ contractor.city }}</b>
                  </p>
                  <p *ngIf="contractor.postcode">
                    kod pocztowy: <b>{{ contractor.postcode }}</b>
                  </p>
                  <p *ngIf="contractor.country">
                    państwo: <b>{{ contractor.country }}</b>
                  </p>
                  <p *ngIf="contractor.ceo">
                    prezes: <b>{{ contractor.ceo }}</b>
                  </p>
                  <p
                    *ngIf="
                      contractor.krs || contractor.regon || contractor.status
                    "
                  >
                    <span *ngIf="contractor.krs"
                      >KRS: <b>{{ contractor.krs }}</b></span
                    >
                    &nbsp;
                    <span *ngIf="contractor.regon"
                      >REGON: <b>{{ contractor.regon }}</b></span
                    >
                    &nbsp;
                    <span *ngIf="contractor.status && dispFields.status"
                      >status: <b>{{ contractor.status }}</b></span
                    >
                  </p>
                </mat-expansion-panel>
              </mat-accordion>
            </span>

            <!-- adres do wysyłki -->

            <span *ngIf="dispFields.adres">
              <mat-accordion>
                <mat-expansion-panel>
                  <mat-expansion-panel-header>
                    Adres do wysyłki
                  </mat-expansion-panel-header>
                  <p *ngIf="contractor.streetShipping">
                    ulica: <b>{{ contractor.streetShipping }}</b>
                  </p>
                  <p *ngIf="contractor.cityShipping">
                    miasto: <b>{{ contractor.cityShipping }}</b>
                  </p>
                  <p *ngIf="contractor.postcodeShipping">
                    kod pocztowy: <b>{{ contractor.postcodeShipping }}</b>
                  </p>
                  <p *ngIf="contractor.countryShipping">
                    kraj: <b>{{ contractor.countryShipping }}</b>
                  </p>
                </mat-expansion-panel>
              </mat-accordion>
            </span>

            <!-- Osoby do kontaktu - wyświetlanie -->

            <span
              *ngIf="
                contractor.anotherContacts.length > 0 && dispFields.kontakty
              "
            >
              <mat-accordion>
                <mat-expansion-panel [expanded]="true">
                  <mat-expansion-panel-header>
                    Osoby do kontaktu
                  </mat-expansion-panel-header>

                  <div>
                    <div
                      *ngIf="contractor.anotherContacts[0].acName"
                      class="tabelaDiv"
                    >
                      <table
                        mat-table
                        [dataSource]="contractor.anotherContacts"
                        class="mat-elevation-z8"
                      >
                        <ng-container matColumnDef="acName">
                          <th
                            mat-header-cell
                            *matHeaderCellDef
                            class="klasaKolumny"
                          >
                            Imię
                          </th>
                          <td
                            mat-cell
                            *matCellDef="let element"
                            class="klasaKolumny"
                          >
                            {{ element.acName }}
                          </td>
                        </ng-container>

                        <ng-container matColumnDef="acSurname">
                          <th
                            mat-header-cell
                            *matHeaderCellDef
                            class="klasaKolumny"
                          >
                            Nazwisko
                          </th>
                          <td
                            mat-cell
                            *matCellDef="let element"
                            class="klasaKolumny"
                          >
                            {{ element.acSurname }}
                          </td>
                        </ng-container>

                        <ng-container matColumnDef="acEmail">
                          <th
                            mat-header-cell
                            *matHeaderCellDef
                            class="klasaKolumny"
                          >
                            Email
                          </th>
                          <td
                            mat-cell
                            *matCellDef="let element"
                            class="klasaKolumny"
                          >
                            {{ element.acEmail }}
                          </td>
                        </ng-container>

                        <ng-container matColumnDef="acPhone">
                          <th
                            mat-header-cell
                            *matHeaderCellDef
                            class="klasaKolumny"
                          >
                            Telefon
                          </th>
                          <td
                            mat-cell
                            *matCellDef="let element"
                            class="klasaKolumny"
                          >
                            {{ element.acPhone }}
                          </td>
                        </ng-container>

                        <ng-container matColumnDef="acComment">
                          <th
                            mat-header-cell
                            *matHeaderCellDef
                            class="klasaKolumny"
                          >
                            Komentarz
                          </th>
                          <td
                            mat-cell
                            *matCellDef="let element"
                            class="klasaKolumny"
                          >
                            {{ element.acComment }}
                          </td>
                        </ng-container>

                        <tr mat-header-row *matHeaderRowDef="acKolumny"></tr>
                        <tr
                          mat-row
                          *matRowDef="let row; columns: acKolumny"
                        ></tr>
                      </table>
                    </div>
                  </div>
                </mat-expansion-panel>
              </mat-accordion>
            </span>
          </div>
        </div>

        <!-- konta bankowe -->

        <div
          *ngIf="
            contractor.bankAccounts &&
            contractor.bankAccounts.length > 0 &&
            dispFields.kontBankowe
          "
        >
          <div *ngIf="contractor.bankAccounts[0].dkNazwa" class="tabelaDiv">
            <p>Konta Bankowe:</p>
            <table
              mat-table
              [dataSource]="contractor.bankAccounts"
              class="mat-elevation-z8"
            >
              <ng-container matColumnDef="dkNazwa">
                <th mat-header-cell *matHeaderCellDef class="klasaKolumny">
                  Nazwa banku
                </th>
                <td mat-cell *matCellDef="let element" class="klasaKolumny">
                  {{ element.dkNazwa }}
                </td>
              </ng-container>

              <ng-container matColumnDef="dkNrKonta">
                <th mat-header-cell *matHeaderCellDef class="klasaKolumny">
                  Numer konta
                </th>
                <td mat-cell *matCellDef="let element" class="klasaKolumny">
                  {{ element.dkNrKonta }}
                </td>
              </ng-container>

              <ng-container matColumnDef="dkDomyslne">
                <th mat-header-cell *matHeaderCellDef class="klasaKolumny">
                  Konto domyślne
                </th>
                <td mat-cell *matCellDef="let element" class="klasaKolumny">
                  <span *ngIf="element.dkDomyslne">TAK</span>
                </td>
              </ng-container>

              <tr mat-header-row *matHeaderRowDef="dkKolumny"></tr>
              <tr mat-row *matRowDef="let row; columns: dkKolumny"></tr>
            </table>
          </div>
        </div>

        <!-- firmy -->

        <div
          *ngIf="
            contractor.firms && contractor.firms.length > 0 && dispFields.firmy
          "
        >
          <br />
          <b>Firmy:</b>
          <ul>
            <li *ngFor="let firma of contractor.firms">{{ firma }}</li>
          </ul>
        </div>

        <!-- projekty -->

        <div
          *ngIf="
            contractor.projects &&
            contractor.projects.length > 0 &&
            dispFields.projekty
          "
        >
          <br />
          <b>Projekty:</b>
          <ul>
            <li *ngFor="let projekt of contractor.projects">{{ projekt }}</li>
          </ul>
        </div>

        <div class="limitkred">
          <p *ngIf="contractor.creditLimit && dispFields.creditLimit">
            Limit kredytowy:
            <b>{{ contractor.creditLimit }}</b>
          </p>
          <p *ngIf="contractor.paymentDeadline && dispFields.paymentDeadline">
            Termin płatności w dniach:
            <b>{{ contractor.paymentDeadline }}</b>
          </p>
          <p *ngIf="contractor.balance && dispFields.balance">
            Saldo:
            <b>{{ contractor.balance }} </b>{{ contractor.creditLimitCurrency }}
          </p>
        </div>
        <div class="fullWidth" *ngIf="contractor.widziCeneEuro">
          <p *ngIf="contractor.widziCeneEuro">
            <b>Kontrahent widzi cenę w Euro</b>
          </p>
        </div>
        <div class="fullWidth" *ngIf="!contractor.widziCeneEuro">
          <p *ngIf="!contractor.widziCeneEuro">
            <b>Kontrahent nie widzi ceny w Euro</b>
          </p>
        </div>
        <div class="fullWidth" *ngIf="contractor.comments">
          <p *ngIf="contractor.comments && dispFields.comments">
            UWAGI:<br />
            <b>{{ contractor.comments }}</b>
          </p>
        </div>
        <div class="fullWidth" *ngIf="contractor.accountManagerLogin">
          <p *ngIf="contractor.accountManager">
            OPIEKUN:<br />
            <b>{{ contractor.accountManager }}</b>
          </p>
        </div>

        <!-- pliki -->

        <span *ngIf="contractor.pliki.length > 0 && dispFields.pliki">
          <div>
            <p>PLIKI: <br /></p>

            <div *ngIf="contractor.pliki[0].name" class="tabelaDiv">
              <table
                mat-table
                [dataSource]="contractor.pliki"
                class="mat-elevation-z8"
              >
                <ng-container matColumnDef="name">
                  <th mat-header-cell *matHeaderCellDef class="klasaKolumny">
                    Nazwa
                  </th>
                  <td mat-cell *matCellDef="let element" class="klasaKolumny">
                    <a
                      href="{{ backendUrl }}/{{ element.katalog }}/{{ element.fileName }}"
                      target="_blank"
                      >{{ element.name }}</a
                    >
                  </td>
                </ng-container>

                <ng-container matColumnDef="rodzaj">
                  <th mat-header-cell *matHeaderCellDef class="klasaKolumny">
                    Typ
                  </th>
                  <td mat-cell *matCellDef="let element" class="klasaKolumny">
                    {{ element.rodzaj }}
                  </td>
                </ng-container>

                <tr mat-header-row *matHeaderRowDef="plikiKolumny"></tr>
                <tr mat-row *matRowDef="let row; columns: plikiKolumny"></tr>
              </table>
            </div>
          </div>
        </span>

        <!-- zmodyfikowany, dodany przez -->

        <div class="fullWidth" *ngIf="contractor.addBy.name">
          <p>
            Dodany przez:
            <b>
              {{ contractor.addBy.name }} {{ contractor.addBy.surname }} -
              {{ contractor.addDate | date: "dd.MM.yyyy HH:mm:ss" }}
            </b>
          </p>
        </div>
        <div class="fullWidth" *ngIf="contractor.modBy.name">
          <p>
            Zmodyfikowany przez:
            <b>
              {{ contractor.modBy.name }} {{ contractor.modBy.surname }} -
              {{ contractor.modDate | date: "dd.MM.yyyy HH:mm:ss" }}
            </b>
          </p>
        </div>

        <!-- przyciski -->

        <mat-action-row>
          <button
            mat-button
            color="primary"
            *ngIf="dispFields.buttonOfertaKontr"
            [routerLink]="['/lazy/offercreatecontr', contractor.id]"
          >
            Przygotuj ofertę
          </button>
          <button
            mat-button
            color="primary"
            *ngIf="dispFields.buttonEdytujKontr"
            [routerLink]="['/contractoredit', contractor.id]"
          >
            Edytuj
          </button>
          <button
            mat-button
            color="warn"
            *ngIf="dispFields.buttonUsunKontr"
            (click)="onDelete(contractor.id, contractor.pliki)"
          >
            Usuń
          </button>
        </mat-action-row>
      </mat-expansion-panel>
    </mat-accordion>
    <mat-paginator
      *ngIf="contractors.length > 0"
      id="topPag"
      [length]="totalContractors"
      [pageSize]="contractorsPerPage"
      [pageSizeOptions]="pageSizeOptions"
      (page)="onChangedPage($event)"
      class="pagbottom"
    >
    </mat-paginator>

    <div id="carddiv" *ngIf="contractors.length <= 0">
      <mat-card class="example-card">
        <mat-card-header>
          <div mat-card-avatar class="example-header-image"></div>
          <mat-card-title>Brak Danych</mat-card-title>
          <mat-card-subtitle
            >W bazie nie ma jeszcze informacji o kontaktach.</mat-card-subtitle
          >
        </mat-card-header>
        <mat-card-actions>
          <button mat-raised-button color="primary" (click)="powrot()">
            Powrót
          </button>
          <button
            mat-raised-button
            color="primary"
            *ngIf="dispFields.buttonDodajKontr"
            routerLink="/contractorcreate"
          >
            Dodaj kontakt
          </button>
        </mat-card-actions>
      </mat-card>
    </div>
  </span>

  <div id="carddiv" *ngIf="!userIsAuthenticated">
    <mat-card class="example-card">
      <mat-card-header>
        <div mat-card-avatar class="example-header-image"></div>
        <mat-card-title>Nie zalogowany</mat-card-title>
        <mat-card-subtitle
          >Zaloguj się do systemu aby odczytać dane.</mat-card-subtitle
        >
      </mat-card-header>
      <mat-card-actions>
        <button mat-raised-button color="primary" routerLink="/login">
          Logowanie do systemu
        </button>
      </mat-card-actions>
    </mat-card>
  </div>
</main>

